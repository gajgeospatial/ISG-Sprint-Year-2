# Proposed Extensions

This table is a proposed set of extensions that FlightSafety proposes for use to replace OpenFlight and CDB capabilities.  This is a comparison between the current version of OpenFlight (version 16.7) and the current version of glTF (version 2.0).

The intent is to identify how models are being used in CDB (layered geometry, static or moving 3D models) and how CDB implements various features that extend beyond typical OpenFlight usage.

## OpenFlight Feature Comparison Table

| Feature         | Description | OpenFlight | CDB OpenFlight | glTF |
|-----------------|-------------|------------|----------------|------|
| Structure       | Model structure and hierarchy | **Header**, **Group**, **Object** | Same | [**Nodes**, **Scenes**](https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#scenes) |
| Transformations | Move, rotate, and scale the contents | Applies to most non-Geometry | Same | Applied to [**Nodes**](https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#transformations) |
| Geometry        | The means to define the geometry of a model | **Mesh**, **Vertex**, **Face**, **Subface** - Creation of arbitrary planar concave and convex polygons to define a surface. | CDB does not allow concave polygons, encourages meshes over arbitrary faces | [**Meshes**](https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#meshes) - A collection of vertices and indices that create triangulated surfaces. |
| Instancing | The ability to create multiple display objects from a single source object. The geometry, appearance, and animation is the same between the instances. | **Instancing**, **Replication** | Same | [**EXT_mesh_gpu_instancing**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_mesh_gpu_instancing)
| Appearance       | The means to put a color, texture, or material on a geometric surface | **Color**, **Texture**, **Material Palettes** - Applies to **Mesh** or **Face**. Use of color & texture entries independently, or a Material entry. _See note below_ | Same | [**Materials**](https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#materials) - Physically Based Material support including advanced PBR features. |
| LOD             | Allows switching between different representations and complexities of a model, based on the distance to the object and potentially other factors. | **Level of Detail** | Same, but CDB [**Level of Detail**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_8_ModelLevelsOfDetail.adoc) uses Significant Size rather than distance based switching, to provide a measurement that is independent of output resolution. |[**MSFT_lod**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/MSFT_lod), using a screen coverage metric.  (_See Below_) |
| Switch          | Allows switching between different (or empty) representations of a model, based on a requested index.  This is a generalized version of LOD and is frequently used for before & after displays. | **Switch** | Same, used for [**Damage States**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_9_ModelSwitchNodes.adoc), simple [**Articulations**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_9_ModelSwitchNodes.adoc#articulations) and [Motion Blur Textures](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_9_ModelSwitchNodes.adoc#temporal-anti-aliasing) | [**KHR_materials_variants**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_variants) provides this functionality for appearance on the same geometry. Except for the LOD indicated above, there is no explicit functionality for this capability.
| Animation       | The means to change geometry and/or appearance of the model over time. There are several sub-types that are listed separately. | _see below_ | _see below_ | _see below_ | 
| Key Frame       | Specifies a collection of important (key) frames. | **Group** - Specifies a collection of frames where each collection is displayed in total replacing the contents of the previous frame. This is like discrete key frames (no interpolation between frames). | Same | [**Animations**](https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations) - This node supports all animation types in glTF. Generally this is done by linearly interpolating between the key frames for the specific type of animation desired.
| Skeletal        | Specifies how the surface moves over a collection of joints in response to the movement of those joints. | _n/a_ | _n/a_ | [**Skins**](https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#skins), [**Animations**](https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations) - Provides data for weighted geometry vertices (skin) and moves them according the animation of the joints.
| Morph           | Specifies a starting and ending geometry, typically down to the level of individual vertices. The system linearly interpolates between the two based on some externally supplied  value. | **Vertex**, **Morph Vertex** | Same |[**Morph Target**](https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#morph-targets), [**Animations**](https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations) |
| Articulation    | Specifies allowed animation within fixed limits at fixed points in the model. | **Degree of Freedom** | Only one DOF per Zone | [**AGI_articulations**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/AGI_articulations), [**Animations**](https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations)
| Lighting        | This feature provides lighting for the model and scene. It may or may not illuminate other objects. Subtypes are listed separately. | _see below_ | _see below_ | _see below_ | 
| Glow Lights     | This feature is small glowing light sources that do not illuminate other objects. | **Light Point** | Same |This is typically done with an emissive color or texture on geometry. There is no explicit support in the format. |
| Punctual Lights | This includes point, spot, and directional lights that illuminate other objects. | **Light Source** - The reference does not provide any indication that directional lights are supported. | | _n/a_ - Support for light interaction with the model appearance is supported; however, the format does not include light definitions. See **Lighting Note** for additional details. |
| IBL             | Image Based Lighting (IBL) is used to illuminate a PB Material model. This provides light from 4pi steradians with the proper coloring for each angle. It is typically used to light an individual location in a scene. | _n/a_ | | [**EXT_lights_image_based**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_lights_image_based) (see Lighting note) |
| Camera/Viewpoint | The location where a virtual camera is put into the scene for viewing the contents. Typically several characteristics of the camera are available for definition including (but not necessarily all) lens, zoom, projection type (*perspective* or *orthographic*) | _n/a_ | CDB allows for a viewpoint **Point** from within a model | [**Cameras**](https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#cameras) (see Viewing note) |
| Text            | The ability to add text to the scene without creating specialized geometry for it. | **Text** | Not used | _n/a_
| Audio           | The ability to add sound to an object (model) or environment. | **Sound** | Not used | [**MSFT_audio_emitter**](https://github.com/KhronosGroup/glTF/pull/1400) There are discussions as to how appropriate this is for glTF in the standardized version. |
| Inclusion       | The ability to include secondary files or datasets as directly as part of the scene. These inclusions do not modify existing objects or features. | **External reference** | Same | _n/a_ |
| Metadata        | The ability to associate data about the node (metadata) with a node. This is usually structured and provides for easy expansion. | **Comment** - This is unstructured plain descriptive text. | **Comment** as structured XML with defined schema | [**KHR_xmp_json_ld**](https://github.com/KhronosGroup/glTF/pull/1893) - Public, but currently unratified extension to provide a structure to store metadata in *various nodes.*


**Table 1:** *A comparison of features supported by OpenFlight and glTF with a focus on the use for Sprint 2. The comparison does not examine structure elements.*

### Notes
**LOD:** OpenFlight can use two different methods of specifying levels of detail.  One is a strict distance turn on/off.  The other method is using Significant Size to identify the largest changes between two LODs.  Using the Significant Size in conjunction with the output system's resolution and viewing angle, allows that system to scale LODs based on the amount of pixel change occurring on screen.  The glTF extension only uses a metric based on screen coverage, with no definition of what a screen represents in the virtual or real world.  A conversion algorithm would be needed to associate CDB Significant Size to screen coverage.

**Appearance:** OpenFlight uses a Diffuse and Specular approach to materials.  There are workflows to convert between Specular and PBR Metalness. There are other similarities between the two formats (normal maps, emissive maps, alpha maps) that help with conversion.

**Lighting:** glTF does support lights; however, the trend is not to have models with lights as they need to interact with something physical to be seen. The lighting is typically supplied by the system handling the display of the glTF model. Model illumination is typically done with IBL. It is possible to include IBL with a model using [EXT_lights_image_based](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_lights_image_based).

**Viewing** Typically cameras are contained and managed in the scene environment to account for different uses of the model. There is no requirements that the model camera must be used.

## Table of CDB Concepts Layered on top of OpenFlight

| CDB Feature | Description | CDB Use Case | glTF |
|-------------|-------------|--------------|------|
| [**Zones**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_5_ModelZones.adoc)  | CDB Concept to name components of interest of a model in a hierarchical manner | Used on **Group**, mostly in Moving Models, to provide component hierarchy and naming to switches, DOFs | [**KHR_xmp**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_xmp) |
| [**Point**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_6_ModelPoints.adoc) | Concept to name a non-modeled point of interest on a model, using the same hierarchical naming as zones. | Used on **Group** as **Model DIS Origin**,  **Viewpoint from Model**, **Attach Point**, **Anchor Point**, **Center of Mass** | [**AGI_articulations**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/AGI_articulations) for Attach Points, [**KHR_xmp**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_xmp) for others  |
| [**Switch**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_9_ModelSwitchNodes.adoc) | Use of a **Switch** to implement a variety of behaviours | Control the state of Model Components (zones and points), used for **Simple Articulations**, **Damaged States**, **Motion Blur Textures**  | ? |
| [**Articulations**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_10_ModelArticulations.adoc) | **DOF** that can be animated automatically, or driven by the simulation | Rotating Parts, such as windmill or radar dish. Driven part such as a vehicle weapon. | ? |
| [**Attribution**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_12_ModelAttributes.adoc) | Use of structured comments that contain XML fragments | General mechanism for adding attribution to portions of a model | [**KHR_xmp**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_xmp)  |
| **Time of Year Textures** | Used to switch appearance of a model based on calendar time | Seasonal or Monthly appearance | [**KHR_materials_variants**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_variants) |
| [**Model Skin Textures**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_13_ModelTextures.adoc#model-skin-textures) | Used to represent different paint schemes | Aircraft models with differing paint schemes, or vehicles with different camouflage schemes | [**KHR_materials_variants**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_variants) |
| [**Multi-Spectral Textures**](https://docs.opengeospatial.org/is/17-080r2/17-080r2.html) | Used to represent a model's appearance in primarily reflective Infrared wavelengths | NVG or SWIR sensor appearance | [**KHR_materials_variants**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_variants) |
| Material Textures | Used to represent the physical material of an object, using a mapped texture | Thermal Infrared or Radar | [**EXT_feature_metadata**](https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_feature_metadata/1.0.0) to store material index, which requires implementing [**Cesium 3D Metadata Specification**](https://github.com/CesiumGS/3d-tiles/tree/3d-tiles-next/specification/Metadata/1.0.0) to replace the Composite Material Table
| [**Model Configurations**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_14_ModelDescriptorMetadataDatasets.adoc#model-configurations) | Optional feature that allows selection of a variety of possible equipment and/or ordinance | Quick loading of a moving model with a preset set of equipment and/or ordinance | Keep separate as XML or JSON? |

**Table 2:** *A list of features supported by CDB, and which glTF extensions can be used to replicate the existing functionality.*

### Notes
**Texture Variants:** *We would recommend using URIs for all but the base material textures.  In this way, a client that does not support the more advanced texture variants can avoid a large amount of I/O for features that are not needed.*

**Texture Variant Naming:** *We would recommend a consistent naming scheme for all CDB variants, so that a client device can find and use a set of variants easily*

