# Proposed Extensions

This table is a proposed set of extensions that FlightSafety proposes for use to replace OpenFlight and CDB capabilities.  This is a comparison between the current version of OpenFlight (version 16.7) and the current version of glTF (version 2.0).

The intent is to identify how models are being used in CDB (layered geometry, static or moving 3D models) and how CDB implements various features that extend beyond typical OpenFlight usage.

## OpenFlight Feature Comparison Table

| Feature         | Description | OpenFlight | CDB OpenFlight | glTF |
|-----------------|-------------|------------|----------------|------|
| Structure       | Model structure and hierarchy | **Header**, **Group**, **Object** | Same | [**Nodes**, **Scenes**](https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#scenes) |
| Transformations | Move, rotate, and scale the contents | Applies to most non-Geometry | Same | Applied to [**Nodes**](https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#transformations) |
| Geometry        | The means to define the geometry of a model | **Mesh**, **Vertex**, **Face**, **Subface** - Creation of arbitrary planar concave and convex polygons to define a surface. | CDB does not allow concave polygons, encourages meshes over arbitrary faces | [**Meshes**](https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#meshes) - A collection of vertices and indices that create triangulated surfaces. |
| Instancing | The ability to create multiple display objects from a single source object. The geometry, appearance, and animation is the same between the instances. | **Instancing**, **Replication** | Same | [**EXT_mesh_gpu_instancing**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_mesh_gpu_instancing)
| Appearance       | The means to put a color, texture, or material on a geometric surface | **Color**, **Texture**, **Material Palettes** - Applies to **Mesh** or **Face**. Use of color & texture entries independently, or a Material entry. _See note below_ | Same | [**Materials**](https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#materials) - Physically Based Material support including advanced PBR features. |
| LOD             | Allows switching between different representations and complexities of a model, based on the distance to the object and potentially other factors. | **Level of Detail** | Same, but CDB [**Level of Detail**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_8_ModelLevelsOfDetail.adoc) uses Significant Size rather than distance based switching, to provide a measurement that is independent of output resolution. |[**MSFT_lod**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/MSFT_lod), using a screen coverage metric.  (_See Below_) |
| Switch          | Allows switching between different (or empty) representations of a model, based on a requested index.  This is a generalized version of LOD and is frequently used for before & after displays. | **Switch** | Same, used for [**Damage States**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_9_ModelSwitchNodes.adoc), simple [**Articulations**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_9_ModelSwitchNodes.adoc#articulations) and [Motion Blur Textures](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_9_ModelSwitchNodes.adoc#temporal-anti-aliasing) | [**KHR_materials_variants**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_variants) provides this functionality for appearance on the same geometry. Except for the LOD indicated above, there is no explicit functionality for this capability.
| Animation       | The means to change geometry and/or appearance of the model over time. There are several sub-types that are listed separately. | _see below_ | _see below_ | _see below_ | 
| Key Frame       | Specifies a collection of important (key) frames. | **Group** - Specifies a collection of frames where each collection is displayed in total replacing the contents of the previous frame. This is like discrete key frames (no interpolation between frames). | Same | [**Animations**](https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations) - This node supports all animation types in glTF. Generally this is done by linearly interpolating between the key frames for the specific type of animation desired.
| Skeletal        | Specifies how the surface moves over a collection of joints in response to the movement of those joints. | _n/a_ | _n/a_ | [**Skins**](https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#skins), [**Animations**](https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations) - Provides data for weighted geometry vertices (skin) and moves them according the animation of the joints.
| Morph           | Specifies a starting and ending geometry, typically down to the level of individual vertices. The system linearly interpolates between the two based on some externally supplied  value. | **Vertex**, **Morph Vertex** | Same |[**Morph Target**](https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#morph-targets), [**Animations**](https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations) |
| Articulation    | Specifies allowed animation within fixed limits at fixed points in the model. | **Degree of Freedom** | Only one DOF per Zone | [**AGI_articulations**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/AGI_articulations), [**Animations**](https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations)
| Lighting        | This feature provides lighting for the model and scene. It may or may not illuminate other objects. Subtypes are listed separately. | _see below_ | _see below_ | _see below_ | 
| Glow Lights     | This feature is small glowing light sources that do not illuminate other objects. | **Light Point** | Same |This is typically done with an emissive color or texture on geometry. There is no explicit support in the format. |
| Punctual Lights | This includes point, spot, and directional lights that illuminate other objects. | **Light Source** - The reference does not provide any indication that directional lights are supported. | | _n/a_ - Support for light interaction with the model appearance is supported; however, the format does not include light definitions. See **Lighting Note** for additional details. |
| IBL             | Image Based Lighting (IBL) is used to illuminate a PB Material model. This provides light from 4pi steradians with the proper coloring for each angle. It is typically used to light an individual location in a scene. | _n/a_ | | [**EXT_lights_image_based**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_lights_image_based) (see Lighting note) |
| Camera/Viewpoint | The location where a virtual camera is put into the scene for viewing the contents. Typically several characteristics of the camera are available for definition including (but not necessarily all) lens, zoom, projection type (*perspective* or *orthographic*) | _n/a_ | CDB allows for a viewpoint **Point** from within a model | [**Cameras**](https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#cameras) (see Viewing note) |
| Text            | The ability to add text to the scene without creating specialized geometry for it. | **Text** | Not used | _n/a_
| Audio           | The ability to add sound to an object (model) or environment. | **Sound** | Not used | [**MSFT_audio_emitter**](https://github.com/KhronosGroup/glTF/pull/1400) There are discussions as to how appropriate this is for glTF in the standardized version. |
| Inclusion       | The ability to include secondary files or datasets as directly as part of the scene. These inclusions do not modify existing objects or features. | **External reference** | Same | _n/a_ |
| Metadata        | The ability to associate data about the node (metadata) with a node. This is usually structured and provides for easy expansion. | **Comment** - This is unstructured plain descriptive text. | **Comment** as structured XML with defined schema | [**KHR_xmp_json_ld**](https://github.com/KhronosGroup/glTF/pull/1893) - Public, but currently unratified extension to provide a structure to store metadata in *various nodes.*


**Table 1:** *A comparison of features supported by OpenFlight and glTF with a focus on the use for Sprint 2. The comparison does not examine structure elements.*

### Notes
**LOD:** OpenFlight can use two different methods of specifying levels of detail.  One is a strict distance turn on/off.  The other method is using Significant Size to identify the largest changes between two LODs.  Using the Significant Size in conjunction with the output system's resolution and viewing angle, allows that system to scale LODs based on the amount of pixel change occurring on screen.  The glTF extension only uses a metric based on screen coverage, with no definition of what a screen represents in the virtual or real world.  A conversion algorithm would be needed to associate CDB Significant Size to screen coverage.

**Appearance:** OpenFlight uses a Diffuse and Specular approach to materials.  There are workflows to convert between Specular and PBR Metalness. There are other similarities between the two formats (normal maps, emissive maps, alpha maps) that help with conversion. dffdf

**Lighting:** glTF does support lights; however, the trend is not to have models with lights as they need to interact with something physical to be seen. The lighting is typically supplied by the system handling the display of the glTF model. Model illumination is typically done with IBL. It is possible to include IBL with a model using [EXT_lights_image_based](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_lights_image_based).

**Viewing** Typically cameras are contained and managed in the scene environment to account for different uses of the model. There is no requirements that the model camera must be used.

## Table of CDB Concepts Layered on top of OpenFlight

| CDB Feature Class | CDB Feature | CDB Model Type | Description | glTF |
|-------------------|-------------|----------------|-------------|------|
| [**Zones**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_5_ModelZones.adoc)  | **Zone** | All CDB Models | Metadata on **Group**, used to provide a hierarchical naming scheme for other features in this table, such as switches, DOFs, etc. | [**KHR_xmp_json_ld**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_xmp_json_ld) |
| [**Point**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_6_ModelPoints.adoc) | | | Provides a hierarchical name to a non-modeled point of interest on a model, similar to zones. |  |
|  | [**Model DIS Origin**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_6_ModelPoints.adoc#model-dis-origin) | Moving Models | Model origin used with DIS/HLA, which can be different than the modeled origin | [**KHR_xmp_json_ld**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_xmp_json_ld) |
|  | [**Model Viewpoint**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_6_ModelPoints.adoc#model-viewpoint) | All models | View from a model (aircraft pilot's seat, ship's navigation post, etc) | **Camera** |
|  | [**Attach Point**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_6_ModelPoints.adoc#model-attach-point) | Primarily Moving Models, Power Line Pylons | Position on a model that other models can be attached to (e.g. fighter aircraft with points to attach munitions or fuel tanks) | [**AGI_articulations**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/AGI_articulations) |
|  | [**Anchor Point**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_6_ModelPoints.adoc#model-anchor-point) | Moving Models | Counterpoint of the **Attach Point**, point where this model can be attached to another model | [**AGI_articulations**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/AGI_articulations) |
|  | [**Center of Mass**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_6_ModelPoints.adoc#model-center-of-mass) | Primarily Moving Models | Center of mass of the model | [**KHR_xmp_json_ld**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_xmp_json_ld) |
| [**Model Conforming**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_7_ModelConforming.adoc) | | Static Models, 2D Tiled Model | A set of modes used to place models onto the terrain | [**KHR_xmp_json_ld**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_xmp_json_ld) |
| [**Levels of Detail**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_8_ModelLevelsOfDetail.adoc) | | Static and Moving Models | Provides device level control of rendering/processing load and memory footprint | [**MSFT_lod**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/MSFT_lod) |
| [**Switch**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_9_ModelSwitchNodes.adoc) | | | Using a **Switch** to control the state of Model Components (zones and points) |  |
|  | [**Articulations**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_9_ModelSwitchNodes.adoc#articulations) | Moving Models | Used when articulated parts are implemented for only a few positions (e.g. aircraft flaps) | ? |
|  | [**Damaged States**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_9_ModelSwitchNodes.adoc#damage-states) | Moving Models | Can be used to select one of many modeled representations of a model with different amounts of damage (0-100% damaged) | ? |
|  | [**Motion Blur Textures**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_9_ModelSwitchNodes.adoc#temporal-anti-aliasing) | Moving Models | Some systems require special textures to eliminate strobing effects on rotating objects (such as rotors or propellers) | ? |
| [**Articulations**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_10_ModelArticulations.adoc) | **DOF** that can be animated automatically, or driven by the simulation | Static or Moving Models | Rotating Parts, such as windmill or radar dish. Driven part such as a vehicle weapon. | [**AGI_articulations**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/AGI_articulations) |
| | **DIS Articulated Part** | Moving Models | Allows a simulation to control an articulation | ? |
| | [**Rotating Part**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_10_ModelArticulations.adoc#rotating-parts) | Static or Moving Models | An articulation that can be animated automatically | ? |
| [**Attribution**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_12_ModelAttributes.adoc) | | All Models | General mechanism using of structured XML comments to add attribution to portions of a model | [**KHR_xmp_json_ld**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_xmp_json_ld)  |
| [**Model Textures**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_13_ModelTextures.adoc) | | All Models | Textured appearance of a model | 
| | **Time of Year Textures** | All Models | Used to switch appearance of a model based on calendar time, either by quarterly seasons or by month | [**KHR_materials_variants**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_variants) |
| | [**Model Skin Textures**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_13_ModelTextures.adoc#model-skin-textures) | All Models | Used to represent different paint or camoflage schemes on a model | [**KHR_materials_variants**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_variants) |
| | [**Multi-Spectral Textures**](https://docs.opengeospatial.org/is/17-080r2/17-080r2.html) | Texture extension used to represent a model's appearance in Infrared wavelengths that are primarily reflective, such as Near IR for NVG use or Short-Wave IR | [**KHR_materials_variants**](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_variants) |
| [**Material Textures**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_13_ModelTextures.adoc#model-material-textures) | | All Models | Texture that stores the materials that make up a surface, independent of the visual base texture.  Used for Thermal Infrared, Radar, or CGF (Computer Generated Forces) | [**EXT_feature_metadata**](https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_feature_metadata/1.0.0) to store material index, which uses [**Cesium 3D Metadata Specification**](https://github.com/CesiumGS/3d-tiles/tree/3d-tiles-next/specification/Metadata/1.0.0) to store the Composite Material Table as either JSON or binary
| [**Model Configurations**](https://github.com/opengeospatial/cdb-volume-6/blob/master/clause_6_14_ModelDescriptorMetadataDatasets.adoc#model-configurations) | | Moving Models | Feature that allows the selection and use of one of a set of possible equipment and/or ordinance loads for a Moving Model | Keep separate as XML or JSON? |

**Table 2:** *A list of features supported by CDB, and which glTF extensions can be used to replicate the existing functionality.*

### Notes on Model Datasets
**Static Models:** *Refers to 3D models, both GeoTypical and GeoSpecific, that are representations of a feature anchored to the ground.*

**Moving Models:** *Refers to 3D models in CDB that are not anchored to the ground.*

**Tiled 2D Model:** *Refers to 2D modeled GeoSpecific or GeoTypical representations of features that are anchored to the ground.*

### Notes on CDB Features
**Texture Variants:** *We would recommend using URIs for all but the base material textures.  In this way, a client that does not support the more advanced texture variants can avoid a large amount of I/O for features that are not needed.*

**Texture Variant Naming:** *We would recommend a consistent naming scheme for all CDB variants, so that a client device can find and use a set of variants easily*

